#!/bin/bash

if grep -qEi '(microsoft|wsl)' /proc/version; then
  pwsh.exe -Command "(netsh wlan show interfaces) -Match '([^B]SSID|Signal|Receive|Transmit)'" \
    | tr -s '\r\n' ';' \
    | sed -rn 's#.*:\s(.*);.*:\s(.*);.*:\s(.*);.*:\s(.*);#"\1" D:\2 U:\3 S:\4#p'
else
    iwconfig_output=$(iwconfig 2>&1)

    essid=$(echo "$iwconfig_output" | grep -oP 'ESSID:"\K([^"]+)')
    bit_rate=$(echo "$iwconfig_output" | grep -oP 'Bit Rate=\K[^ ]+' | cut -d' ' -f1)
    link_quality=$(echo "$iwconfig_output" | grep -oP 'Link Quality=\K[^ ]+' | cut -d' ' -f1)
    signal_level=$(echo "$iwconfig_output" | grep -oP 'Signal level=\K[^ ]+' | cut -d' ' -f1)

    echo "\"$essid\" D:$bit_rate Q:$link_quality S:$signal_level dBm"
fi